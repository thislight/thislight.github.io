var ce=Object.defineProperty,le=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var L=(e,t,r)=>t in e?ce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,d=(e,t)=>{for(var r in t||(t={}))ue.call(t,r)&&L(e,r,t[r]);if(P)for(var r of P(t))ge.call(t,r)&&L(e,r,t[r]);return e},O=(e,t)=>le(e,de(t));import{c as he,A,d as n,m as pe,t as g,V as me,u as W,q as C,H as E,z as fe,r as x,v as ve,S as R,e as H}from"./index.13b310ab.js";import{c as D,A as Ce,T as xe,C as G,M as J,P as be}from"./Popover.e8cf0efd.js";import{g as ze,a as Ie,b as m,s as Re,d as ye,c as De,B as we}from"./ButtonBase.9bf595f5.js";import{u as Me}from"./solid.5ae8e60d.js";import{T as u,C as V,L as S,a as y}from"./SvgIcon.c425712b.js";import{B as M}from"./Button.f5ab4cd7.js";import{D as p,a as Te,b as _e}from"./index.c1adcc6d.js";import{F as h,S as ke,R as Ne}from"./index.79b5287a.js";import"./isHostComponent.9ebad583.js";import"./getDeviceId.e8f3946a.js";function Be(e){return Ie("MuiIconButton",e)}const Fe=ze("MuiIconButton",["root","disabled","colorInherit","colorPrimary","colorSecondary","edgeStart","edgeEnd","sizeSmall","sizeMedium","sizeLarge"]),Ue=he()({name:"MuiIconButton",selfPropNames:["children","classes","color","disableFocusRipple","disabled","edge","size"],propDefaults:({set:e})=>e({edge:!1,color:"default",disabled:!1,disableFocusRipple:!1,size:"medium"}),utilityClass:Be,slotClasses:e=>({root:["root",e.disabled&&"disabled",e.color!=="default"&&`color${m(e.color)}`,e.edge&&`edge${m(e.edge)}`,`size${m(e.size)}`]})}),$e=Re(ye,{name:"MuiIconButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.color!=="default"&&t[`color${m(r.color)}`],r.edge&&t[`edge${m(r.edge)}`],t[`size${m(r.size)}`]]}})(({theme:e,ownerState:t})=>d(d(d({textAlign:"center",flex:"0 0 auto",fontSize:e.typography.pxToRem(24),padding:8,borderRadius:"50%",overflow:"visible",color:e.palette.action.active,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest})},!t.disableRipple&&{"&:hover":{backgroundColor:A(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}}),t.edge==="start"&&{marginLeft:t.size==="small"?-3:-12}),t.edge==="end"&&{marginRight:t.size==="small"?-3:-12}),({theme:e,ownerState:t})=>O(d(d(d(d({},t.color==="inherit"&&{color:"inherit"}),t.color!=="inherit"&&t.color!=="default"&&d({color:e.palette[t.color].main},!t.disableRipple&&{"&:hover":{backgroundColor:A(e.palette[t.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}})),t.size==="small"&&{padding:5,fontSize:e.typography.pxToRem(18)}),t.size==="large"&&{padding:12,fontSize:e.typography.pxToRem(28)}),{[`&.${Fe.disabled}`]:{backgroundColor:"transparent",color:e.palette.action.disabled}})),Pe=Ue.component(function({allProps:t,classes:r,otherProps:c,props:l}){return n($e,pe({get className(){return De(r.root,c.className)},centerRipple:!0,get focusRipple(){return!l.disableFocusRipple},get disabled(){return l.disabled},ownerState:t},c,{get children(){return l.children}}))}),Le=g('<svg><path d="M0 0h24v24H0z" fill="none"></path></svg>',4,!0),Oe=g('<svg><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>',4,!0);var Ae=D(()=>[Le.cloneNode(!0),Oe.cloneNode(!0)],"Close");const Ee=g('<svg><path d="M0 0h24v24H0z" fill="none"></path></svg>',4,!0),He=g('<svg><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"></path></svg>',4,!0);var We=D(()=>[Ee.cloneNode(!0),He.cloneNode(!0)],"Person");const Ge=g('<svg><path d="M0 0h24v24H0z" fill="none"></path></svg>',4,!0),Je=g('<svg><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg>',4,!0);var Ve=D(()=>[Ge.cloneNode(!0),Je.cloneNode(!0)],"Link");const Se=g('<svg><path d="M17 7h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.43-.98 2.63-2.31 2.98l1.46 1.46C20.88 15.61 22 13.95 22 12c0-2.76-2.24-5-5-5zm-1 4h-2.19l2 2H16zM2 4.27l3.11 3.11C3.29 8.12 2 9.91 2 12c0 2.76 2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1 0-1.59 1.21-2.9 2.76-3.07L8.73 11H8v2h2.73L13 15.27V17h1.73l4.01 4L20 19.74 3.27 3 2 4.27z"></path></svg>',4,!0),Ye=g('<svg><path d="M0 24V0" fill="none"></path></svg>',4,!0);var je=D(()=>[Se.cloneNode(!0),Ye.cloneNode(!0)],"LinkOff");const Xe=3e3,Ze=3e3,I=302;var a;(function(e){e[e.Unknown=0]="Unknown",e[e.Found=1]="Found",e[e.Joined=2]="Joined",e[e.NotFound=3]="NotFound"})(a||(a={}));const qe=e=>n(J,{get open(){return e.open},get children(){return n(V,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",maxWidth:"650px"},get children(){return n(G,{sx:{textAlign:"center"},get children(){return n(u,{children:"Communicating with Magicbroad..."})}})}})}}),Ke=e=>{const t=W();return n(J,{get open(){return e.open},get children(){return n(V,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",maxWidth:"650px"},get children(){return[n(G,{get children(){return[n(u,{variant:"h6",children:"The Room is Missing"}),n(u,{children:"We could not found the room you want. The owner might have been deleted the room."})]}}),n(S,{get children(){return n(y,{sx:{paddingLeft:0,paddingRight:0},get children(){return n(M,{variant:"text",sx:{width:"100%",justifyContent:"flex-end"},onClick:()=>t("/"),get children(){return n(u,{sx:{marginRight:"20px"},component:"div",children:"Go to the Home Page"})}})}})}})]}})}})},Qe=e=>{const t=()=>{const[c,l]=e.position;return{left:c,top:l}},r={cursor:"pointer"};return n(be,{get open(){return typeof e.position!="undefined"},anchorReference:"anchorPosition",get anchorPosition(){return t()},onClose:()=>e.onClose(),get children(){return n(S,{get children(){return[n(y,{sx:r,onClick:()=>e.onChangingDrawingTool(p.pen),get children(){return[n(u,{children:"Pen"}),n(R,{get when(){return e.currentDrawingTool===p.pen},children:"*"})]}}),n(y,{sx:r,onClick:()=>e.onChangingDrawingTool(p.erase),get children(){return[n(u,{children:"Erase"}),n(R,{get when(){return e.currentDrawingTool===p.erase},children:"*"})]}}),n(y,{sx:r,onClick:()=>e.onChangingDrawingTool(p.hand),get children(){return[n(u,{children:"Move"}),n(R,{get when(){return e.currentDrawingTool===p.hand},children:"*"})]}})]}})}})},go=()=>{const e=me(),t=Me(),r=W(),[c,l]=C(a.Unknown),[b,Y]=C(),[T,j]=C(p.pen),[X,_]=C(),[f,Z]=C(),z=new Te("black",20),w=new Map,[k,q]=E(()=>{const o=b();return o?t.getParticipants(o.id):[]}),[K,N]=E(()=>{const o=b();return o?t.getRoomOpts(o.id).then(async i=>i.size_x&&i.size_y?i:(await t.setRoomOpts(o.id,{size_x:Xe,size_y:Ze}),await t.getRoomOpts(o.id))):Promise.resolve(void 0)}),Q=o=>{_([o.pageX,o.pageY])},B=o=>{const i=w.get(o);return typeof i=="undefined"?(w.set(o,[]),B(o)):i},ee=o=>{if(o.message.length>=1){const i=o.message[0];if(i.isUInt()){const s=i.toUInt();if(console.log(s),s===I&&o.message.length>=5){const[,v,re,ie,se]=o.message,ae={x:v.toUInt(),y:re.toUInt(),lineWidth:ie.toUInt(),color:se.toString()},$=B(o.srcUserDeviceId);$.push(ae),z.draw($)}else s===I&&o.message.length>=2&&w.set(o.srcUserDeviceId,[])}}},F=o=>{const i=o[o.length-1],s=f();s&&s.broadcast([h.fromUInt(I,!0),h.fromUInt(i.x,!0),h.fromUInt(i.y,!0),h.fromUInt(i.lineWidth,!0),h.fromString(i.color,!1)],!0)},oe=()=>{const o=f();o&&o.broadcast([h.fromUInt(I,!0),h.zero(0)],!0)},U=o=>{const i=ke.ofRoom(t.supabase,o,t.getUserDeviceId()),s=new Ne(t.getUserDeviceId(),i,o);return s.bus.on("addpeer",v=>{console.log("addpeer",v)}),s.bus.on("removepeer",v=>{v.disconnect()}),s.bus.on("data",ee),s};fe(async()=>{const o=await t.findRoomById(e.id);o?(l(a.Found),Y(o),await t.isJoinedRoomById(o.id)||await t.joinRoomById(o.id),l(a.Joined),N.refetch()):l(a.NotFound)}),x(()=>{c()===a.Joined&&q.refetch()}),x(()=>{z.setTool(T())}),x(()=>{const o=K();o?o.size_x&&o.size_y&&z.setOffscreenSize([o.size_x,o.size_y]):N.refetch()}),x(()=>{const o=b();o&&Z(i=>i&&i.roomId!==o.id?(i.stop(),U(o.id)):typeof i=="undefined"?U(o.id):i)}),x(()=>{const o=f();o&&o.broadcastPeerList()}),ve(()=>{const o=f();o&&o.stop()});const te=()=>c()===a.Unknown||c()===a.Found,ne=()=>c()===a.NotFound;return[n(qe,{get open(){return te()}}),n(Ke,{get open(){return ne()}}),n(Qe,{get position(){return X()},onClose:()=>_(),get currentDrawingTool(){return T()},onChangingDrawingTool:o=>j(o)}),n(we,{sx:{flexGrow:1},get children(){return n(Ce,{position:"absolute",color:"transparent",get children(){return n(xe,{get children(){return[n(Pe,{size:"large",edge:"start",color:"inherit","aria-label":"close",sx:{mr:2},onClick:()=>r("/"),get children(){return n(Ae,{})}}),n(u,{variant:"h6",component:"div",sx:{flexGrow:1},children:()=>{var o;return(o=b())==null?void 0:o.name}}),n(M,{size:"large",color:"inherit",variant:"text",get children(){return n(R,{get when(){return f()},get fallback(){return n(je,{})},get children(){return n(Ve,{})}})}}),n(M,{size:"large",color:"inherit",variant:"text",get children(){return[n(We,{}),H(()=>{var o;return H(()=>!!k.loading,!0)()?"...":(o=k())==null?void 0:o.length})]}})]}})}})}}),n(_e,{ctl:z,onContextMenu:Q,onStart:F,onDrawing:F,onEnd:oe})]};export{go as default};
//# sourceMappingURL=index.016e8a17.js.map
